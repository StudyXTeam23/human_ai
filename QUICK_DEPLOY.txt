===============================================================
        Linux 服务器快速部署指南
===============================================================

📋 准备工作:

1. 服务器要求:
   - Ubuntu 20.04+ / CentOS 8+ / Debian 11+
   - 2核+ CPU, 4GB+ 内存
   - 公网 IP,开放 80/443 端口

2. 本地准备:
   - SSH 访问权限
   - 域名 (yourdomain.com)
   - OpenAI API Key

===============================================================

🚀 快速部署步骤:

步骤 1: 连接服务器
-----------------------
ssh root@your-server-ip

步骤 2: 上传项目
-----------------------
# 方式 A: 使用 SCP (从本地执行)
cd /Users/yuyuan/studyx_human
tar -czf studyx_human.tar.gz \
  --exclude='node_modules' \
  --exclude='venv' \
  --exclude='.next' \
  .
scp studyx_human.tar.gz root@your-server-ip:/tmp/

# 在服务器上解压
ssh root@your-server-ip
mkdir -p /var/www
cd /var/www
tar -xzf /tmp/studyx_human.tar.gz
mv studyx_human.tar.gz studyx_human

# 方式 B: 使用 Git
cd /var/www
git clone https://github.com/yourusername/studyx_human.git

步骤 3: 运行自动部署脚本
-----------------------
cd /var/www/studyx_human

# 3.1 配置服务器环境 (首次部署)
sudo bash deploy-scripts/setup-server.sh

# 3.2 部署后端
bash deploy-scripts/deploy-backend.sh
# 根据提示配置 .env 文件 (添加 OPENAI_API_KEY)

# 3.3 部署前端
bash deploy-scripts/deploy-frontend.sh
# 根据提示输入 API URL

# 3.4 配置 Nginx
sudo bash deploy-scripts/setup-nginx.sh
# 根据提示输入域名

步骤 4: 配置 DNS
-----------------------
在域名服务商添加 A 记录:
  yourdomain.com     → 服务器IP
  www.yourdomain.com → 服务器IP
  api.yourdomain.com → 服务器IP

步骤 5: 配置 SSL (推荐)
-----------------------
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
sudo certbot --nginx -d api.yourdomain.com

步骤 6: 测试
-----------------------
# 测试 API
curl https://api.yourdomain.com/health

# 测试前端
curl -I https://yourdomain.com

# 浏览器访问
https://yourdomain.com

===============================================================

🔧 常用管理命令:

后端服务:
  sudo systemctl status ai-humanizer-api     # 查看状态
  sudo systemctl restart ai-humanizer-api    # 重启
  sudo journalctl -u ai-humanizer-api -f     # 查看日志

前端服务:
  pm2 status                                 # 查看状态
  pm2 restart ai-humanizer-web               # 重启
  pm2 logs ai-humanizer-web                  # 查看日志

Nginx:
  sudo systemctl restart nginx               # 重启
  sudo nginx -t                              # 测试配置
  sudo tail -f /var/log/nginx/error.log     # 查看日志

===============================================================

📂 重要文件路径:

项目目录:
  /var/www/studyx_human/

后端:
  配置文件: /var/www/studyx_human/web/backend/.env
  日志文件: /var/log/ai-humanizer/
  服务文件: /etc/systemd/system/ai-humanizer-api.service

前端:
  配置文件: /var/www/studyx_human/web/frontend/.env.production
  
Nginx:
  配置文件: /etc/nginx/sites-available/ai-humanizer
  日志文件: /var/log/nginx/

===============================================================

🐛 常见问题:

1. 后端无法启动?
   sudo journalctl -u ai-humanizer-api -n 50

2. 前端无法访问?
   pm2 logs ai-humanizer-web --lines 50

3. Nginx 报错?
   sudo nginx -t
   sudo tail -f /var/log/nginx/error.log

4. 无法连接 OpenAI API?
   # 检查 .env 配置
   cat /var/www/studyx_human/web/backend/.env | grep OPENAI
   
   # 测试网络
   curl -I https://api.openai.com

5. 权限问题?
   sudo chown -R www-data:www-data /var/www/studyx_human/web/backend
   sudo chmod -R 755 /var/www/studyx_human/web/backend

===============================================================

📚 详细文档:

完整部署指南: DEPLOY_TO_LINUX.md

===============================================================

✅ 部署成功标志:

- [ ] 后端 API 正常响应: https://api.yourdomain.com/health
- [ ] 前端页面可访问: https://yourdomain.com
- [ ] 可以输入文本并点击 Humanize
- [ ] 处理成功并跳转到结果页
- [ ] HTTPS 证书有效

===============================================================

