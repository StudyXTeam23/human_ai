===============================================================
        �� 服务器项目路径已更新
===============================================================

✅ 新的项目路径:

旧路径: /var/www/studyx_human
新路径: /root/home/yuyuan/studyx_human

===============================================================

📝 已更新的文件:

部署脚本:
  ✅ deploy-scripts/setup-server.sh
     - PROJECT_DIR="/root/home/yuyuan/studyx_human"
     - 创建目录: /root/home/yuyuan
  
  ✅ deploy-scripts/deploy-backend.sh
     - PROJECT_DIR="/root/home/yuyuan/studyx_human/web/backend"
  
  ✅ deploy-scripts/deploy-frontend.sh
     - PROJECT_DIR="/root/home/yuyuan/studyx_human/web/frontend"

文档:
  ✅ DEPLOY_TO_LINUX.md
     - 所有路径引用已更新
  
  ✅ QUICK_DEPLOY.txt
     - 所有路径引用已更新
  
  ✅ DEPLOYMENT_SUMMARY.txt
     - 所有路径引用已更新

===============================================================

🚀 部署步骤 (使用新路径):

步骤 1: 上传项目到服务器
-----------------------
# 从本地打包
cd /Users/yuyuan/studyx_human
tar -czf studyx.tar.gz --exclude='node_modules' --exclude='venv' --exclude='.next' .

# 上传到服务器
scp studyx.tar.gz root@your-server-ip:/root/home/yuyuan/

# SSH 到服务器
ssh root@your-server-ip

# 创建目录并解压
mkdir -p /root/home/yuyuan
cd /root/home/yuyuan
tar -xzf studyx.tar.gz -C studyx_human
# 或者如果目录不存在
mkdir studyx_human
tar -xzf studyx.tar.gz -C studyx_human

步骤 2: 运行部署脚本
-----------------------
cd /root/home/yuyuan/studyx_human

# 配置服务器环境 (首次)
bash deploy-scripts/setup-server.sh

# 部署后端
bash deploy-scripts/deploy-backend.sh

# 部署前端
bash deploy-scripts/deploy-frontend.sh

# 配置 Nginx
bash deploy-scripts/setup-nginx.sh

步骤 3: 配置 SSL
-----------------------
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
sudo certbot --nginx -d api.yourdomain.com

===============================================================

📂 重要路径:

项目根目录:
  /root/home/yuyuan/studyx_human/

后端:
  代码: /root/home/yuyuan/studyx_human/web/backend
  配置: /root/home/yuyuan/studyx_human/web/backend/.env
  虚拟环境: /root/home/yuyuan/studyx_human/web/backend/venv
  上传目录: /root/home/yuyuan/studyx_human/web/backend/uploads

前端:
  代码: /root/home/yuyuan/studyx_human/web/frontend
  配置: /root/home/yuyuan/studyx_human/web/frontend/.env.production
  构建输出: /root/home/yuyuan/studyx_human/web/frontend/.next

日志:
  后端日志: /var/log/ai-humanizer/
  Nginx日志: /var/log/nginx/

服务配置:
  Systemd: /etc/systemd/system/ai-humanizer-api.service
  Nginx: /etc/nginx/sites-available/ai-humanizer

===============================================================

🔧 Systemd 服务配置:

服务文件会自动生成在:
  /etc/systemd/system/ai-humanizer-api.service

关键配置内容:
  WorkingDirectory=/root/home/yuyuan/studyx_human/web/backend
  Environment="PATH=/root/home/yuyuan/studyx_human/web/backend/venv/bin"
  EnvironmentFile=/root/home/yuyuan/studyx_human/web/backend/.env
  ExecStart=/root/home/yuyuan/studyx_human/web/backend/venv/bin/gunicorn \
      app.main:app \
      --workers 4 \
      --worker-class uvicorn.workers.UvicornWorker \
      --bind 0.0.0.0:18201

===============================================================

🛠️ 常用管理命令:

后端服务:
  sudo systemctl status ai-humanizer-api
  sudo systemctl restart ai-humanizer-api
  sudo journalctl -u ai-humanizer-api -f

前端服务:
  pm2 status
  pm2 restart ai-humanizer-web
  pm2 logs ai-humanizer-web

查看配置:
  # 后端配置
  cat /root/home/yuyuan/studyx_human/web/backend/.env
  
  # 前端配置
  cat /root/home/yuyuan/studyx_human/web/frontend/.env.production
  
  # 服务配置
  cat /etc/systemd/system/ai-humanizer-api.service

查看日志:
  # 后端日志
  tail -f /var/log/ai-humanizer/error.log
  
  # Nginx 日志
  tail -f /var/log/nginx/error.log

===============================================================

⚠️  权限设置:

由于项目在 /root/home 下,需要注意权限配置:

1. Systemd 服务配置中:
   User=root  (而不是 www-data)
   Group=root (而不是 www-data)

2. 或者,如果想使用 www-data 用户,需要:
   sudo chown -R www-data:www-data /root/home/yuyuan/studyx_human
   sudo chmod -R 755 /root/home/yuyuan/studyx_human

建议: 使用 root 用户运行服务,因为项目在 /root 目录下

===============================================================

🧪 测试部署:

1. 测试后端 API
   curl http://localhost:18201/health
   # 预期: {"status":"healthy","version":"1.0.0"}

2. 测试前端
   curl http://localhost:18200
   # 预期: 返回 HTML

3. 测试通过域名访问
   curl https://api.yourdomain.com/health
   curl https://yourdomain.com

===============================================================

📋 部署检查清单:

[ ] 项目已上传到 /root/home/yuyuan/studyx_human
[ ] 后端 .env 已配置 (OPENAI_API_KEY)
[ ] 前端 .env.production 已配置
[ ] 后端虚拟环境已创建
[ ] 后端依赖已安装
[ ] 前端依赖已安装
[ ] 前端已构建
[ ] Systemd 服务已配置和启动
[ ] PM2 已启动前端
[ ] Nginx 已配置
[ ] SSL 证书已申请
[ ] 防火墙端口已开放 (80, 443)
[ ] 健康检查通过

===============================================================

📚 相关文档:

- 完整部署指南: DEPLOY_TO_LINUX.md
- 快速部署: QUICK_DEPLOY.txt
- 部署总结: DEPLOYMENT_SUMMARY.txt
- 端口配置: PORT_CHANGES_SUMMARY.txt

===============================================================

✅ 路径配置已更新完成!

现在可以使用新路径进行部署:
  项目目录: /root/home/yuyuan/studyx_human

===============================================================
